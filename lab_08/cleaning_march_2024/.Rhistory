setwd("C:/Users/nmradmin/Desktop/hands_on_classes/20220305_r_3_gathering_and_cleaning_data_saturday_repeat_3039")
#background on tidyverse: https://www.tidyverse.org/packages/
# install.packages("formattable")
#install.packages("janitor")
#install.packages("tidyverse")
#install.packages("jsonlite")
library(tidyverse)
library(janitor)
library(lubridate)
library(jsonlite)
vignette("json-apis", package = "jsonlite")
res <- fromJSON('http://ergast.com/api/f1/2004/1/results.json')
View(res)
res <- fromJSON('http://ergast.com/api/f1/2004/1/results.json')
View(res)
drivers <- res[["MRData"]][["RaceTable"]][["Races"]][["Results"]][[1]][["Driver"]]
colnames(drivers)
## Retrieve County Vaccine Data from ADH FEED
#County vaccination json feed
#35 Variables
vaxjson <- fromJSON('https://services5.arcgis.com/vlhGQkz6fSnofVMD/ArcGIS/rest/services/ADH_COVID19_VACCINATIONS_BY_COUNTY/FeatureServer/0/query?where=0%3D0&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&returnCentroid=false&featureEncoding=esriDefault&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnUniqueIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnQueryGeometry=false&returnDistinctValues=false&cacheHint=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=pjson&token=')
View(vaxjson )
vax <- vaxjson[["features"]][["attributes"]]
glimpse(vax)
#Add system date
vax$date <- Sys.Date()
#clean column names
vax <- clean_names(vax)
#Translate column name jargon
vax <- vax %>%
rename(Date = "date",
County_Name = "adh_covid19_vac_join_county_nam",
County_Vax_Total =  "vac_demo_county_aggregate_count",
White_Total = "vac_demo_county_race0_total",
Black_Total= "vac_demo_county_race1_total",
Native_American_Total = "vac_demo_county_race2_total",
Asian_Total = "vac_demo_county_race3_total",
Pacific_Islander_Total = "vac_demo_county_race4_total",
Unk_Race_Total = "vac_demo_county_race5_total",
Other_Race_Total= "vac_demo_county_race6_total",
Hispanic_Total= "vac_demo_county_ethnicity_hispa",
Dose_1 = "vac_demo_county_dose_one",
Dose_2 = "vac_demo_county_dose_two",
Unk_Dose= "vac_demo_county_unk_dose",
Partial_Vax= "vac_demo_county_partially_immun",
Fully_Vax = "vac_demo_county_fully_immunized",
Hispanic_Partial_Vax = "vac_demo_county_partially_hispa",
Hispanic_Full_Vax = "vac_demo_county_fully_hispanic",
Population = "vac_demo_county_population",
County_Pct_Dose_1 = "vac_demo_county_percent_dose_1",
County_Pct_Dose_2 = "vac_demo_county_percent_dose_2",
County_Pct_Population = "vac_demo_county_percent_populat",
White_Partial_Pct= "vac_demo_county_partially_white",
Black_Partial_Pct= "vac_demo_county_partially_black",
Asian_Partial_Pct = "vac_demo_county_partially_aian",
Non_Hispanic_Partial_Pct= "vac_demo_county_partially_nhopi",
White_Full_Pct = "vac_demo_county_fully_white",
Black_Full_Pct = "vac_demo_county_fully_black",
Asian_Full_Pct= "vac_demo_county_fully_aian",
Non_Hispanic_Full_Pct = "vac_demo_county_fully_nhopi")
#Add system date
vax$date <- Sys.Date()
#clean column names
vax <- clean_names(vax)
#Translate column name jargon
vax <- vax %>%
rename(Date = "date",
County_Name = "adh_covid19_vac_join_county_nam",
County_Vax_Total =  "vac_demo_county_aggregate_count",
White_Total = "vac_demo_county_race0_total",
Black_Total= "vac_demo_county_race1_total",
Native_American_Total = "vac_demo_county_race2_total",
Asian_Total = "vac_demo_county_race3_total",
Pacific_Islander_Total = "vac_demo_county_race4_total",
Unk_Race_Total = "vac_demo_county_race5_total",
Other_Race_Total= "vac_demo_county_race6_total",
Hispanic_Total= "vac_demo_county_ethnicity_hispa",
Dose_1 = "vac_demo_county_dose_one",
Dose_2 = "vac_demo_county_dose_two",
Unk_Dose= "vac_demo_county_unk_dose",
Partial_Vax= "vac_demo_county_partially_immun",
Fully_Vax = "vac_demo_county_fully_immunized",
Hispanic_Partial_Vax = "vac_demo_county_partially_hispa",
Hispanic_Full_Vax = "vac_demo_county_fully_hispanic",
Population = "vac_demo_county_population",
County_Pct_Dose_1 = "vac_demo_county_percent_dose_1",
County_Pct_Dose_2 = "vac_demo_county_percent_dose_2",
County_Pct_Population = "vac_demo_county_percent_populat",
White_Partial_Pct= "vac_demo_county_partially_white",
Black_Partial_Pct= "vac_demo_county_partially_black",
Asian_Partial_Pct = "vac_demo_county_partially_aian",
Non_Hispanic_Partial_Pct= "vac_demo_county_partially_nhopi",
White_Full_Pct = "vac_demo_county_fully_white",
Black_Full_Pct = "vac_demo_county_fully_black",
Asian_Full_Pct= "vac_demo_county_fully_aian",
Non_Hispanic_Full_Pct = "vac_demo_county_fully_nhopi")
vax_summary <- vax %>%
select(County_Name, County_Vax_Total, Partial_Vax, Fully_Vax,Unk_Dose, Population, Date)
#Basic math
vax_summary <- vax_summary %>%
mutate(Full_Pct =(Fully_Vax/Population))
copspeak <- rio::import("Radio_Codes_2016.xlsx", which ="RadioCodes")
#Add system date
vax$date <- Sys.Date()
#clean column names
vax <- clean_names(vax)
#Translate column name jargon
vax <- vax %>%
rename(Date = "date",
County_Name = "adh_covid19_vac_join_county_nam",
County_Vax_Total =  "vac_demo_county_aggregate_count",
White_Total = "vac_demo_county_race0_total",
Black_Total= "vac_demo_county_race1_total",
Native_American_Total = "vac_demo_county_race2_total",
Asian_Total = "vac_demo_county_race3_total",
Pacific_Islander_Total = "vac_demo_county_race4_total",
Unk_Race_Total = "vac_demo_county_race5_total",
Other_Race_Total= "vac_demo_county_race6_total",
Hispanic_Total= "vac_demo_county_ethnicity_hispa",
Dose_1 = "vac_demo_county_dose_one",
Dose_2 = "vac_demo_county_dose_two",
Unk_Dose= "vac_demo_county_unk_dose",
Partial_Vax= "vac_demo_county_partially_immun",
Fully_Vax = "vac_demo_county_fully_immunized",
Hispanic_Partial_Vax = "vac_demo_county_partially_hispa",
Hispanic_Full_Vax = "vac_demo_county_fully_hispanic",
Population = "vac_demo_county_population",
County_Pct_Dose_1 = "vac_demo_county_percent_dose_1",
County_Pct_Dose_2 = "vac_demo_county_percent_dose_2",
County_Pct_Population = "vac_demo_county_percent_populat",
White_Partial_Pct= "vac_demo_county_partially_white",
Black_Partial_Pct= "vac_demo_county_partially_black",
Asian_Partial_Pct = "vac_demo_county_partially_aian",
Non_Hispanic_Partial_Pct= "vac_demo_county_partially_nhopi",
White_Full_Pct = "vac_demo_county_fully_white",
Black_Full_Pct = "vac_demo_county_fully_black",
Asian_Full_Pct= "vac_demo_county_fully_aian",
Non_Hispanic_Full_Pct = "vac_demo_county_fully_nhopi")
