#lab_11 Rob Wells, April 11, 2024

## About this lab

To complete this lab, you need to: \* write code in empty codeblocks provided to answer questions included (look for **Q**). \* write out the answer in the form of a complete sentence in the space given (look for **A**).

When you are finished, commit changes and push to your personal GitHub repo, then submit the URL to this document on ELMS.

## Overview

There are three main goals of this lab:

-   learn to make use of R packages that can access data via third-party APIs.
-   learn to develop a quick and accurate understanding of what data can be obtained via third-party APIs.
-   learn to develop questions that can be answered using that data, and avoid developing questions that cannot.

## APIs to choose from

-   tidycensus - for asking census-related questions.

## Load libraries

**Task**: load the tidyverse and janitor. Uncomment the one other package you plan to work with. Do not choose more than one API package.

```{r}

library(tidyverse)
library(janitor)
library(tidycensus)

```

## Get setup to access third-party APIs

### tidycensus

Use the U.S. census access token you created for this week's lab. You can store it by editing the block below to replace 'YOUR KEY HERE' with your actual key, a long string of letters and numbers. If you need to sign up for another one, you can do so here: [apply for an API key with the Census Bureau](https://api.census.gov/data/key_signup.html).

```{r}

census_api_key("9788f1a2c2f48db2b495aa1230cfb9bfb24d44b2", install=TRUE)

```

### tidycensus

This package is designed to help you pull demographic information about different U.S. geographies.

-   Basic usage https://walker-data.com/tidycensus/articles/basic-usage.html
-   Functions: https://walker-data.com/tidycensus/reference/index.html
-   More details https://walker-data.com/tidycensus/

Sample question: which state saw the largest growth in Hispanic population between 2010 and 2020?

```{r}

acs_vars <- load_variables(dataset = "acs5", year=2020)

md <- get_acs(geography = "county",
              variables = c(median_income = "B19013_001"),
              state = "MD",
              year = 2020) 

```

### Develop and answer questions

**Task** Develop two different *interesting* questions that you can answer with the data. Run them by your professor before getting started on answering, to ensure they're sufficiently interesting and possible with the data.

1.  Which U.S. state had the highest concentration of white youth (under 18) in 2020? Black youth?
2.  Which U.S. state had the highest number of married-couple households with kids in 2020? No kids?

**Task** Write code to answer the questions. Write up a sentence with each of your findings. Produce at least one visualization to support one of your findings.

```{r}

# Question 1

acs_vars_q_1 <- load_variables(dataset = "acs5", year = 2020)

white_pop <- get_acs(
  geography = "state",
  variables = c(population = "B01001A_001"),
  year = 2020
)

black_pop <- get_acs(
  geography = "state",
  variables = c(population = "B01001B_001"),
  year = 2020
)

total_white_pop <- sum(white_pop$estimate)
total_black_pop <- sum(black_pop$estimate)

white_youth_pop <- get_acs(
  geography = "state",
  variables = c(
    population = "B01001A_003", "B01001A_004", "B01001A_005", "B01001A_006",
    "B01001A_018", "B01001A_019", "B01001A_020", "B01001A_021"
  ),
  year = 2020
)

black_youth_pop <- get_acs(
  geography = "state",
  variables = c(
    population = "B01001B_003", "B01001B_004", "B01001B_005", "B01001B_006",
    "B01001B_018", "B01001B_019", "B01001B_020", "B01001B_021"
  ),
  year = 2020
)

total_white_youth_pop <- sum(white_youth_pop$estimate)
total_black_youth_pop <- sum(black_youth_pop$estimate)

state_estimates_white <- white_youth_pop %>%
  group_by(NAME) %>%
  summarise(state_estimate_white = sum(estimate))

state_estimate_white <- sum(state_estimates_white$state_estimate_white)

total_population <- bind_rows(white_pop, black_pop) %>%
  group_by(NAME) %>%
  summarise(state_total_pop = sum(estimate))

state_estimates_white <- state_estimates_white %>%
  left_join(total_population, by = "NAME") %>%
  mutate(pct_of_total = (state_estimate_white / state_total_pop) * 100) %>%
  arrange(desc(pct_of_total)) %>%
  head(1) %>%
  print()

state_estimates_black <- black_youth_pop %>%
  group_by(NAME) %>%
  summarise(state_estimate_black = sum(estimate))

state_estimate_black <- sum(state_estimates_black$state_estimate_black)

state_estimates_black <- state_estimates_black %>%
  left_join(total_population, by = "NAME") %>%
  mutate(pct_of_total = (state_estimate_black / state_total_pop) * 100) %>%
  arrange(desc(pct_of_total)) %>%
  head(1) %>%
  print()

```

Utah has the highest concentration of white youth, and Washington, D.C. has the highest concentration of Black youth.

```{r}

acs_vars_q_2 <- load_variables(dataset = "acs5", year = 2020)

married_with_kids_pop <- get_acs(
  geography = "state",
  variables = c(population = "B11012_003"),
  year = 2020
)

married_no_kids_pop <- get_acs(
  geography = "state",
  variables = c(population = "B11012_004"),
  year = 2020
)

total_married_couple_pop <- get_acs(
  geography = "state",
  variables = c(population = "B11012_002"),
  year = 2020
) %>%
pull(estimate)

married_with_kids_pop <- married_with_kids_pop %>%
  mutate(pct_of_total = (estimate / total_married_couple_pop) * 100) %>%
  arrange(desc(pct_of_total)) %>%
  head(1) %>%
  print()

married_no_kids_pop <- married_no_kids_pop %>%
  mutate(pct_of_total = (estimate / total_married_couple_pop) * 100) %>%
  arrange(desc(pct_of_total)) %>%
  head(1) %>%
  print()

```

Utah has the highest percentage of married-couple households with kids out of all married-couple households in the state, and Puerto Rico has the highest number of married-couple households with no kids out of all married-couple households in the territory.
